<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Chi tiết bài đăng</title>
    <link rel="stylesheet" href="CSS/baidang.css" /><link rel="stylesheet" href="CSS/SanPham.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      if (sessionStorage.getItem("adminLoggedIn") !== "true") {
  alert("Bạn chưa đăng nhập hoặc phiên đã hết.");
  const email = prompt("Username");
  const password = prompt("Key");
  fetch("https://server-web-hagotree.glitch.me/admin", {
    method: "POST",
    headers: {
      "Content-Type": "application/json"
    },
    body: JSON.stringify({
      loginEmail: email,
      loginPassword: password
    })
  })
    .then((res) =>
      res.json().then((data) => ({
        status: res.status,
        body: data
      }))
    )
    .then(({ status, body }) => {
      if (status === 202) {
        sessionStorage.setItem("adminLoggedIn", "true");
        alert("Đăng nhập thành công!");
      } else {
        alert("Sai email hoặc mật khẩu");
         window.location.href = "/Admin.html";
      }
    })
    .catch((err) => {
      console.error("Lỗi:", err);
      alert("Lỗi kết nối tới server");
    });

}
// Hiệu ứng ripple cho nút
document.querySelectorAll('.section-toggle-btn, .form-container button[type="submit"]').forEach(btn => {
  btn.addEventListener('click', function (e) {
    const circle = document.createElement('span');
    circle.classList.add('ripple');
    const rect = btn.getBoundingClientRect();
    circle.style.left = `${e.clientX - rect.left}px`;
    circle.style.top = `${e.clientY - rect.top}px`;
    btn.appendChild(circle);
    setTimeout(() => circle.remove(), 500);
  });
});

// Hiện/ẩn nội dung và đổi tên nút
[
  {btn: 'toggleDonHang', container: 'donHangContainer', label: ['Hiện đơn hàng', 'Ẩn đơn hàng']},
  {btn: 'toggleGiaoDich', container: 'GiaoDichContainer', label: ['Hiện giao dịch', 'Ẩn giao dịch']},
  {btn: 'toggleLienHe', container: 'LienHeContainer', label: ['Hiện liên hệ', 'Ẩn liên hệ']},
  {btn: 'toggleFeedBack', container: 'FeedBackContainer', label: ['Hiện phản hồi', 'Ẩn phản hồi']},
  {btn: 'toggleBaiViet', container: 'BaiVietContainer', label: ['Hiện bài viết', 'Ẩn bài viết']},
].forEach(({btn, container, label}) => {
  const btnEl = document.getElementById(btn);
  const contEl = document.getElementById(container);
  if (btnEl && contEl) {
    btnEl.textContent = label[0];
    contEl.style.display = 'none';
    btnEl.addEventListener('click', () => {
      if (contEl.style.display === 'none' || contEl.style.display === '') {
        contEl.style.display = 'block';
        btnEl.textContent = label[1];
        contEl.animate([{opacity:0},{opacity:1}],{duration:300,fill:'forwards'});
      } else {
        contEl.animate([{opacity:1},{opacity:0}],{duration:200,fill:'forwards'}).onfinish = () => {
          contEl.style.display = 'none';
          btnEl.textContent = label[0];
        };
      }
    });
  }
});

    </script>
<link rel="stylesheet" href="CSS/admin.css" />
<style>
    table {
      border-collapse: collapse;
      width: 100%;
    }
    th, td {
      padding: 8px;
      border: 1px solid #ccc;
    }
    th {
      background: #f2f2f2;
    }
  </style>
  </head>
  <body>

    <div class="admin-layout">
  <nav class="admin-sidebar" id="adminSidebar">
  <div class="sidebar-header">
    <button class="sidebar-toggle" id="sidebarToggle">
      <i class="fas fa-bars"></i>
    </button>
    <span class="sidebar-title">Menu</span>
  </div>
  <ul>
    <li data-section="donHangSection" class="active">
      <i class="fas fa-receipt"></i> <span>Đơn hàng</span>
    </li>
    <li data-section="giaoDichSection">
      <i class="fas fa-check-circle"></i> <span>Xác nhận đơn</span>
    </li>
    <li data-section="lienHeSection">
      <i class="fas fa-envelope"></i> <span>Liên hệ</span>
    </li>
    <li data-section="feedbackSection">
      <i class="fas fa-comment-dots"></i> <span>Feedback</span>
    </li>
    <li data-section="baiVietSection">
      <i class="fas fa-newspaper"></i> <span>Bài viết</span>
    </li>
    <li data-section="dangSanPhamSection">
      <i class="fas fa-plus-square"></i> <span>Đăng sản phẩm mới</span>
    </li>
  </ul>
</nav>
  <div class="admin-main-content">
  <section class="section-card admin-section-content" id="donHangSection">
    <div class="section-header">
      <h3 class="section-title">ĐƠN HÀNG</h3>
    </div>
    <div id="donHangContainer" class="section-table-wrap">
      <div style="max-height: 300px; overflow-y: auto;">
        <table id="DonHangTable">
          <thead>
            <tr>
              <th>Họ tên</th>
              <th>Email</th>
              <th>Điện thoại</th>
              <th>Địa chỉ</th>
              <th>Ghi chú</th>
              <th>Mã giao dịch</th>
              <th>Trạng thái đơn</th>
              <th>Tỉnh/TP</th>
              <th>Sản phẩm</th>
              <th>Thời gian đặt</th>
              <th>Thời gian giao</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </section>
  <section class="section-card admin-section-content" id="giaoDichSection">
    <div class="section-header">
      <h3 class="section-title">XÁC NHẬN ĐƠN</h3>
    </div>
    <div id="GiaoDichContainer">
      <form id="xndform" class="form-container">
        <label for="MaGiaoDich">MÃ GIAO DỊCH CẦN THỰC HIỆN</label>
        <input type="text" id="MaGiaoDich" name="MaGiaoDich" required />
        <select id="chonxacnhan" required>
          <option selected value="xn">Xác nhận đơn</option>
          <option value="ht">Đã hoàn thành</option>
          <option value="hd">Hủy đơn</option>
          <option value="xd">Xóa đơn</option>
          <option value="tg">Thời gian giao đơn</option>
        </select>
        <button type="submit">XÁC NHẬN ĐƠN</button>
      </form>
    </div>
  </section>
  <section class="section-card admin-section-content" id="lienHeSection">
    <div class="section-header">
      <h3 class="section-title">LIÊN HỆ</h3>
    </div>
    <div id="LienHeContainer" class="section-table-wrap">
      <div style="max-height: 300px; overflow-y: auto;">
        <table id="LienHeTable">
          <thead>
            <tr>
              <th>Họ tên</th>
              <th>Email</th>
              <th>Điện thoại</th>
              <th>Lời nhắn</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </section>
  <section class="section-card admin-section-content" id="feedbackSection">
    <div class="section-header">
      <h3 class="section-title">FeedBack Sản Phẩm</h3>
    </div>
    <div id="FeedBackContainer" class="section-table-wrap">
      <div style="max-height: 300px; overflow-y: auto;">
        <table id="FeedBackTable">
          <thead>
            <tr>
              <th>Sản phẩm</th>
              <th>Lời nhắn</th>
              <th>Email người gửi</th>
              <th>Ảnh</th>
              <th>Sao</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
  </section>
  <section class="section-card admin-section-content" id="baiVietSection">
    <div class="section-header">
      <h3 class="section-title">Bài viết</h3>
    </div>
    <div id="BaiVietContainer">
      <div style="max-height: 500px; overflow-y: auto;">
        <iframe style="border:none;" src="https://mmqstore.io.vn/wp/posthaogtree" height="500px" width="100%"></iframe>
      </div>
    </div>
  </section>
  <section class="section-card admin-section-content" id="dangSanPhamSection">
    <h3 class="section-title">Đăng sản phẩm mới</h3>
    <form id="postForm" enctype="multipart/form-data" class="form-container">
      <label for="title">Tên sản phẩm:</label>
      <input type="text" id="title" name="title" required />
      <label for="image">Ảnh minh họa:</label>
      <div class="custom-file-input">
  <label for="image" class="file-label">
    <span id="fileLabelText">Chọn tệp</span>
    <input type="file" id="image" name="image" accept="image/*" />
  </label>
</div>
      <label for="cost">Gía sản phẩm:</label>
      <input type="number" id="cost" name="cost" required />
      <label for="content">Miêu tả sản phẩm:</label>
      <textarea id="content" name="content" rows="10" required></textarea>
      <label for="tag_product">Chọn tag cho sản phẩm:</label>
      <select id="tag_product" name="tag" required>
        <option selected value="caycanhnhantao">Cây cảnh nhân tạo</option>
        <option value="chaucay">Chậu cây</option>
        <option value="combochaucay">Combo cây chậu</option>
        <option value="caycanh">Cây cảnh</option>
      </select>
      <button type="submit">Đăng bài</button>
    </form>
    <div id="successMessage" style="display: none;">
      Bài viết đã được lưu! Bạn có thể xem lại trong danh sách bài đăng.
    </div>
  </section>
</div>
 
  </div>
     <script>
       
const contentform = document.getElementById("postForm");
const xacnhanform = document.getElementById("xndform");
const thanhcongform = document.getElementById("dntcform");

contentform.addEventListener("submit", async (e) => {
  e.preventDefault();

  const formData = new FormData(contentform);
  fetch("https://dssc.hagotree.site/upload-post", {
    method: "POST",
    body: formData, 
  })
    .then((res) => {
      if (res.ok) {
        document.getElementById("successMessage").style.display = "block";
        contentform.reset();
      } else {
        alert("Lỗi khi đăng bài viết!");
      }
    })
    .catch((err) => {
      console.error(err);
      alert("Lỗi kết nối đến server.");
    });
});

xacnhanform.addEventListener("submit", function (e) {
  e.preventDefault();
  const xacnhanformdata = Object.fromEntries(new FormData(xacnhanform).entries()); 
  if(chonxacnhan.value=="xn"){
    fetch('https://dssc.hagotree.site/xac-nhan-don', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify(xacnhanformdata) 
  })

  .then(async (response) => {
      console.log("Status:", response.status);
      const data = await response.json().catch(() => ({}));
      console.log("Response body:", data);

      if (response.status === 201) {
        alert("Xong");
      } else {
        alert("Có lỗi xảy ra, vui lòng thử lại.\n" + (data.message || ""));
      }
    })
    .catch((error) => {
      console.error("Fetch error:", error);
      alert("Lỗi kết nối tới server!");
    });
}

else if (chonxacnhan.value == "ht") {
  fetch("https://dssc.hagotree.site/xac-nhan-don-xong", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
    },
    body: JSON.stringify(xacnhanformdata),
  })
    .then(async (response) => {
      console.log("Status:", response.status);
      const data = await response.json().catch(() => ({}));
      console.log("Response body:", data);

      if (response.status === 201) {
        alert("Xong");
      } else {
        alert("Có lỗi xảy ra, vui lòng thử lại.\n" + (data.message || ""));
      }
    })
    .catch((error) => {
      console.error("Fetch error:", error);
      alert("Lỗi kết nối tới server!");
    });
}
else if (chonxacnhan.value == "tg") {
  const datattime = prompt("Nhập thời gian giao");

  const maGiaoDichx = document.getElementById("MaGiaoDich").value;

  const dataToSend = {
    thoiGianGiao: datattime,
    maGiaoDich: maGiaoDichx
  };

  fetch("https://dssc.hagotree.site/thoi-gian-giao", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
    },
    body: JSON.stringify(dataToSend),
  })
    .then(async (response) => {
      console.log("Status:", response.status);
      const data = await response.json().catch(() => ({}));
      console.log("Response body:", data);

      if (response.status === 201) {
        alert("Xong");
      } else {
        alert("Có lỗi xảy ra, vui lòng thử lại.\n" + (data.message || ""));
      }
    })
    .catch((error) => {
      console.error("Fetch error:", error);
      alert("Lỗi kết nối tới server!");
    });
}

  else if(chonxacnhan.value=="hd"){
      fetch('https://dssc.hagotree.site/huy-don', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(xacnhanformdata)  
      })

      .then(async (response) => {
          console.log("Status:", response.status);
          const data = await response.json().catch(() => ({}));
          console.log("Response body:", data);

          if (response.status === 201) {
            alert("Xong");
          } else {
            alert("Có lỗi xảy ra, vui lòng thử lại.\n" + (data.message || ""));
          }
        })
        .catch((error) => {
          console.error("Fetch error:", error);
        });
  }
   else if(chonxacnhan.value=="xd"){
      fetch('https://dssc.hagotree.site/xoa-don', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(xacnhanformdata)  
        })
            .then(async (response) => {
            console.log("Status:", response.status);
            const data = await response.json().catch(() => ({}));
            console.log("Response body:", data);

            if (response.status === 201) {
              alert("Xong");
            } else {
              alert("Có lỗi xảy ra, vui lòng thử lại.\n" + (data.message || ""));
            }
          })
          .catch((error) => {
            console.error("Fetch error:", error);
            alert("Lỗi kết nối tới server!");
          });
      }

})






function convertToBase64(file) {  //chuyển ảnh sang dạng byte64
  return new Promise((resolve, reject) => {
    const reader = new FileReader();
    reader.onload = () => resolve(reader.result); 
    reader.onerror = reject;
    reader.readAsDataURL(file);
  });
}

     </script>

     <script>
let cityData = [];


fetch("https://raw.githubusercontent.com/kenzouno1/DiaGioiHanhChinhVN/master/data.json")
  .then(response => response.json()) 
  .then(data => {
    cityData = data;
    loadOrders(); 
  })
  .catch(error => {
    console.error("Lỗi khi tải dữ liệu tỉnh thành:", error);
  });

function getDiaChi(dayString) {
  if (!dayString || !dayString.includes(",")) return "Không rõ";

  const [wardId, districtId, cityId] = dayString.split(",");

  const city = cityData.find(c => c.Id === cityId);
  if (!city) return "Không rõ thành phố";

  const district = city.Districts.find(d => d.Id === districtId);
  if (!district) return `${city.Name}`;

  const ward = district.Wards.find(w => w.Id === wardId);
  if (!ward) return `${district.Name}, ${city.Name}`;

  return `${ward.Name}, ${district.Name}, ${city.Name}`;
}

fetch("https://dssc.hagotree.site/lh")
    .then(res => res.json())
    .then(data => {
      const tbody = document.querySelector("#LienHeTable tbody");
      data.forEach(lienhe => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${lienhe.name}</td>
          <td>${lienhe.email}</td>
          <td>${lienhe.phone}</td>
          <td>${lienhe.message}</td>
        `;
        tbody.appendChild(row);
      });
    })
    .catch(err => {
      console.error("Lỗi khi lấy đơn hàng:", err);
      document.body.innerHTML += "<p style='color:red;'>Không thể tải liên hệ!</p>";
    });
fetch("https://dssc.hagotree.site/fb")
    .then(res => res.json())
    .then(data => {
      const tbody = document.querySelector("#FeedBackTable tbody");
      data.forEach(feedbackx => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${feedbackx.product}</td>
          <td>${feedbackx.feedback}</td>
          <td>${feedbackx.email}</td>
          <td><img src="https://dssc.hagotree.site/${feedbackx.image}" alt="Ảnh Feedback" style="max-width:200px;"></td>
          <td>${feedbackx.star}</td>
        `;
        tbody.appendChild(row);
      });
    })
    .catch(err => {
      console.error("Lỗi khi lấy đơn hàng:", err);
      document.body.innerHTML += "<p style='color:red;'>Không thể tải liên hệ!</p>";
    });
function loadOrders() {
  fetch("https://dssc.hagotree.site/dh")
    .then(res => res.json())
    .then(data => {
      const tbody = document.querySelector("#DonHangTable tbody");
      data.forEach(order => {
        const donHangParsed = JSON.parse(order.DonHang || "[]");
        const productList = donHangParsed.map(p => `
          <div>
            <strong>${p.name}</strong> - ${p.price.toLocaleString()}₫ × ${p.quantity}
            <br><img src="IMG/${p.image}" width="50">
          </div>
        `).join("");

        const diaChiGoc = getDiaChi(order.DiaChiTinhThanh);

        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${order.Name}</td>
          <td>${order.email}</td>
          <td>${order.phone}</td>
          <td>${order.address}</td>
          <td>${order.note}</td>
          <td>${order.MaGiaoDich}</td>
          <td>${order.Ttdon}</td>
          <td>${diaChiGoc}</td>
          <td>${productList}</td>
          <td>${order.TimeDatHang}</td>
          <td>${order.TimeNhanHang}</td>
        `;
        tbody.appendChild(row);
      });
    })
    .catch(err => {
      console.error("Lỗi khi lấy đơn hàng:", err);
      document.body.innerHTML += "<p style='color:red;'>Không thể tải đơn hàng!</p>";
    });
}
document.addEventListener("DOMContentLoaded", () => {
  const btn = document.getElementById("toggleDonHang");
  const btn1 = document.getElementById("toggleGiaoDich");
  const btn2 = document.getElementById("toggleLienHe");
  const btn3 = document.getElementById("toggleFeedBack");
  const btn4 = document.getElementById("toggleBaiViet");

  const donHangDiv = document.getElementById("donHangContainer");
  const giaoDichDiv = document.getElementById("GiaoDichContainer");
  const lienHeDiv = document.getElementById("LienHeContainer");
  const feedBackDiv = document.getElementById("FeedBackContainer");
  const baiVietDiv = document.getElementById("BaiVietContainer");

  btn.addEventListener("click", () => {
    toggleDiv(donHangDiv, btn, "Xem đơn hàng", "Ẩn đơn hàng");
  });

  btn1.addEventListener("click", () => {
    toggleDiv(giaoDichDiv, btn1, "Xem giao dịch", "Ẩn giao dịch");
  });

  btn2.addEventListener("click", () => {
    toggleDiv(lienHeDiv, btn2, "Xem liên hệ", "Ẩn liên hệ");
  });

  btn3.addEventListener("click", () => {
    toggleDiv(feedBackDiv, btn3, "Xem phản hồi", "Ẩn phản hồi");
  });

  btn4.addEventListener("click", () => {
    toggleDiv(baiVietDiv, btn4, "Xem bài viết", "Ẩn bài viết");
  });

  function toggleDiv(div, button, textShow, textHide) {
    if (div.style.display === "none" || div.style.display === "") {
      div.style.display = "block";
      button.textContent = textHide;
    } else {
      div.style.display = "none";
      button.textContent = textShow;
    }
  }
});
document.addEventListener("DOMContentLoaded", function () {
  // Ẩn tất cả section, chỉ hiện section đầu tiên
  document.querySelectorAll('.admin-section-content').forEach((sec, idx) => {
    sec.classList.toggle('active', idx === 0);
    if (idx === 0) sec.style.opacity = 1;
    else sec.style.opacity = 0;
  });

  document.querySelectorAll('.admin-sidebar li').forEach(li => {
    li.addEventListener('click', function () {
      // Đổi active menu
      document.querySelectorAll('.admin-sidebar li').forEach(x => x.classList.remove('active'));
      this.classList.add('active');
      // Ẩn/hiện section với hiệu ứng
      const sectionId = this.getAttribute('data-section');
      document.querySelectorAll('.admin-section-content').forEach(sec => {
        if (sec.id === sectionId) {
          sec.classList.add('active');
          sec.style.transition = 'opacity 0.4s';
          sec.style.opacity = 1;
        } else {
          sec.classList.remove('active');
          sec.style.transition = 'opacity 0.4s';
          sec.style.opacity = 0;
        }
      });
    });
  });
});
document.addEventListener("DOMContentLoaded", function () {
  const sidebar = document.getElementById('adminSidebar');
  const toggleBtn = document.getElementById('sidebarToggle');

  toggleBtn.addEventListener('click', function () {
    sidebar.classList.toggle('collapsed');
  });
});
document.addEventListener("DOMContentLoaded", function() {
  const fileInput = document.getElementById('image');
  const fileLabelText = document.getElementById('fileLabelText');
  if (fileInput && fileLabelText) {
    fileInput.addEventListener('change', function() {
      fileLabelText.textContent = this.files && this.files.length > 0 ? this.files[0].name : 'Chọn tệp';
    });
  }
});
</script>

         <script src="JS/index.js"></script>
</html>
