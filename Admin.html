<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Chi tiết bài đăng</title>
    <link rel="stylesheet" href="CSS/baidang.css" /><link rel="stylesheet" href="CSS/SanPham.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
<link rel="stylesheet" href="CSS/index.css" />
<style>
    table {
      border-collapse: collapse;
      width: 100%;
    }
    th, td {
      padding: 8px;
      border: 1px solid #ccc;
    }
    th {
      background: #f2f2f2;
    }
  </style>
  </head>
  <header class="main-header">
  <div class="top-header">
    <div class="header-left">
      <a href="index.html"><img src="IMG/logo.png" alt="logo" class="logo-hago"/></a>
    </div>

    <div class="search-container">
      <span class="search-icon">🔍</span>
      <input class="searchbox" type="search" placeholder="Tìm kiếm..." />
    </div>

    <div class="right-icons">
      <a href="HTML/LienHe.html" class="icon-link"><img src="IMG/HAGOLH.png" /><span>Liên hệ</span></a>
      <a href="GioHang.html" class="icon-link"><img src="IMG/HAGOGH.png" /><span>Giỏ hàng</span><span class="cart-count"></span></a>
      <a href="HTML/dangnhap.html" class="icon-link"><img src="IMG/HAGOTK.png" /><span id="Accountchecker">Đăng nhập/đăng ký</span></a>
    </div>
  </div>

    </header>
    <br><hr>  
<h3>GIAO DỊCH</h3>
<div style="max-height: 300px;max-width: 70%; overflow-y: auto; " class="container">
 <table id="DonHangTable">

      <tr>
        <th>Họ tên</th>
        <th>Email</th>
        <th>Điện thoại</th>
        <th>Địa chỉ</th>
        <th>Ghi chú</th>
        <th>Mã giao dịch</th>
        <th>Trạng thái đơn</th>
        <th>Tỉnh/TP</th>
        <th>Sản phẩm</th>
      </tr>
    </table>
 </div>   
 <form id="xndform">
    <label for="title">ĐIỀN MÃ GIAO DỊCH XÁC NHẬN ĐƠN HÀNG ĐÃ THANH TOÁN</label>
    <input type="text" id="MaGiaoDich" name="MaGiaoDich" required />
    <button type="submit">XÁC NHẬN ĐƠN</button>
  </form>

   <form id="dntcform">
    <label for="title">MÃ GIAO DỊCH ĐÃ GIAO HÀNG THÀNH CÔNG</label>
    <input type="text" id="MaGiaoDich" name="MaGiaoDich" required />
    <button type="submit">XÁC NHẬN ĐƠN</button>
  </form>
 <br><hr>
<h3>LIÊN HỆ</h3>
<div style="max-height: 300px;max-width: 60%; overflow-y: auto; "><table id="LienHeTable">

      <tr>
        <th>Họ tên</th>
        <th>Email</th>
        <th>Điện thoại</th>
        <th>Lời nhắn</th>
      </tr>
    </table></div>
    <br><hr>
<h3>FeedBack Sản Phẩm</h3>
<div> <br><hr>
  <div style="max-height: 300px;max-width: 60%; overflow-y: auto; "><table id="FeedBackTable">

      <tr>
        <th>Sản phẩm</th>
        <th>Lời nhắn</th>
        <th>Email người gửi</th>
      </tr>
    </table></div>


</div>
<div style="max-height: 500px;max-width: 50%;  overflow-y: auto; ">
  <main id = "ContentPost">
    
  </main>
</div>  <br><hr>
<main class="form-container">
  <form id="postForm">
    <label for="title">Tiêu đề bài viết:</label>
    <input type="text" id="title" name="title" required />

    <label for="image">Ảnh minh họa (chọn từ máy):</label>
    <input type="file" id="image" name="image" accept="image/*" />

    <label for="content">Nội dung bài viết:</label>
    <textarea id="content" name="content" rows="10" required></textarea>

    <button type="submit">Đăng bài</button>
  </form>

  <div id="successMessage" style="display: none;">
    Bài viết đã được lưu! Bạn có thể xem lại trong danh sách bài đăng.
  </div>
</main>




  </body>
   <footer>
  <div class="footer-container">
    <div class="footer-section">
      <h2>Hago Tree</h2>
      <p>Chuyên cây cảnh nhân tạo thẩm mỹ – Đẹp bền vững theo thời gian.</p>
    </div>
    <div class="footer-section">
      <h2>Liên hệ</h2>
      <p><i class="fas fa-map-marker-alt"></i> Hẻm 1581, Đường Bùi Hữu Nghĩa, Phường Tân Hạnh, TP. Biên Hòa, Đồng Nai</p>
      <p><i class="fas fa-envelope"></i> HagoTree@gmail.com</p>
      <p><i class="fas fa-phone-alt"></i> 0968 123 456</p>
    </div>
    <div class="footer-section">
      <h2>Theo dõi</h2>
      <div class="footer-social">
        <a href="https://www.facebook.com/HagoTreee" target="_blank" aria-label="Facebook">
          <i class="fab fa-facebook-f"></i>
        </a>
        <a href="https://zalo.me/yourZaloID" target="_blank" aria-label="Zalo">
          <img src="https://upload.wikimedia.org/wikipedia/commons/9/91/Icon_of_Zalo.svg" alt="Zalo" class="zalo-icon">
        </a>
      </div>
      <p style="margin-top:8px;font-size:13px;">Kết nối với chúng tôi để nhận ưu đãi & tin tức mới nhất!</p>
    </div>
  </div>
  <div class="footer-quote">
    <em>“Cây cảnh giả, cảm xúc thật.”</em>
  </div>
  <div class="footer-bottom">
    &copy; 2025 Hago Tree. All rights reserved.
  </div>
</footer>
     <script>
       
const contentform = document.getElementById("postForm");
const xacnhanform = document.getElementById("xndform");
const thanhcongform = document.getElementById("dntcform");


xacnhanform.addEventListener("submit", function (e) {
  e.preventDefault();
  const xacnhanformdata = Object.fromEntries(new FormData(xacnhanform).entries()); 

  fetch('https://server-web-hagotree.glitch.me/xac-nhan-don', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify(xacnhanformdata)  // xử lý các phần riêng biệt thành những phần tử trong json
  })

  .then(response => {
    if (response.status === 201) {
      alert('Xác nhận đơn '+xacnhanformdata);
    } else {
      alert('Có lỗi xảy ra, vui lòng thử lại.');
    }
  })
});

thanhcongform.addEventListener("submit", function (e) {
  e.preventDefault();
  const thanhcongformdata = Object.fromEntries(new FormData(thanhcongform).entries()); 

  fetch('https://server-web-hagotree.glitch.me/xac-nhan-don-xong', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify(thanhcongformdata)  // xử lý các phần riêng biệt thành những phần tử trong json
  })

  .then(response => {
    if (response.status === 201) {
      alert('Xong');
    } else {
      alert('Có lỗi xảy ra, vui lòng thử lại.');
    }
  })
});





contentform.addEventListener("submit", async (e) => {
  e.preventDefault();

  const contentformdata = Object.fromEntries(new FormData(contentform).entries());

  const imageFile = contentform.image.files[0];

  if (imageFile) {
    try {
      contentformdata.image = await convertToBase64(imageFile); 
    } catch (err) {
      console.error("Lỗi chuyển ảnh:", err);
      alert("Không thể xử lý ảnh!");
      return;
    }
  } else {
    contentformdata.image = "";
  }

  fetch("https://server-web-hagotree.glitch.me/upload-post", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
    },
    body: JSON.stringify(contentformdata),
  })
    .then((res) => {
      if (res.ok) {
        document.getElementById("successMessage").style.display = "block";
        contentform.reset();
      } else {
        alert("Lỗi khi đăng bài viết!");
      }
    })
    .catch((err) => {
      console.error(err);
      alert("Lỗi kết nối đến server.");
    });
});

function convertToBase64(file) {  //chuyển ảnh sang dạng byte64
  return new Promise((resolve, reject) => {
    const reader = new FileReader();
    reader.onload = () => resolve(reader.result); 
    reader.onerror = reject;
    reader.readAsDataURL(file);
  });
}

     </script>

     <script>
let cityData = [];


fetch("https://raw.githubusercontent.com/kenzouno1/DiaGioiHanhChinhVN/master/data.json")
  .then(response => response.json()) 
  .then(data => {
    cityData = data;
    loadOrders(); 
  })
  .catch(error => {
    console.error("Lỗi khi tải dữ liệu tỉnh thành:", error);
  });

function getDiaChi(dayString) {
  if (!dayString || !dayString.includes(",")) return "Không rõ";

  const [wardId, districtId, cityId] = dayString.split(",");

  const city = cityData.find(c => c.Id === cityId);
  if (!city) return "Không rõ thành phố";

  const district = city.Districts.find(d => d.Id === districtId);
  if (!district) return `${city.Name}`;

  const ward = district.Wards.find(w => w.Id === wardId);
  if (!ward) return `${district.Name}, ${city.Name}`;

  return `${ward.Name}, ${district.Name}, ${city.Name}`;
}

fetch("https://server-web-hagotree.glitch.me/lh")
    .then(res => res.json())
    .then(data => {
      const tbody = document.querySelector("#LienHeTable tbody");
      data.forEach(lienhe => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${lienhe.name}</td>
          <td>${lienhe.email}</td>
          <td>${lienhe.phone}</td>
          <td>${lienhe.message}</td>
        `;
        tbody.appendChild(row);
      });
    })
    .catch(err => {
      console.error("Lỗi khi lấy đơn hàng:", err);
      document.body.innerHTML += "<p style='color:red;'>Không thể tải liên hệ!</p>";
    });
fetch("https://server-web-hagotree.glitch.me/fb")
    .then(res => res.json())
    .then(data => {
      const tbody = document.querySelector("#FeedBackTable tbody");
      data.forEach(feedbackx => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${feedbackx.product}</td>
          <td>${feedbackx.feedback}</td>
          <td>${feedbackx.email}</td>
        `;
        tbody.appendChild(row);
      });
    })
    .catch(err => {
      console.error("Lỗi khi lấy đơn hàng:", err);
      document.body.innerHTML += "<p style='color:red;'>Không thể tải liên hệ!</p>";
    });
function loadOrders() {
  fetch("https://server-web-hagotree.glitch.me/dh")
    .then(res => res.json())
    .then(data => {
      const tbody = document.querySelector("#DonHangTable tbody");
      data.forEach(order => {
        const donHangParsed = JSON.parse(order.DonHang || "[]");
        const productList = donHangParsed.map(p => `
          <div>
            <strong>${p.name}</strong> - ${p.price.toLocaleString()}₫ × ${p.quantity}
            <br><img src=".${p.image}" width="50">
          </div>
        `).join("");

        const diaChiGoc = getDiaChi(order.DiaChiTinhThanh);

        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${order.Name}</td>
          <td>${order.email}</td>
          <td>${order.phone}</td>
          <td>${order.address}</td>
          <td>${order.note}</td>
          <td>${order.MaGiaoDich}</td>
          <td>${order.Ttdon}</td>
          <td>${diaChiGoc}</td>
          <td>${productList}</td>
        `;
        tbody.appendChild(row);
      });
    })
    .catch(err => {
      console.error("Lỗi khi lấy đơn hàng:", err);
      document.body.innerHTML += "<p style='color:red;'>Không thể tải đơn hàng!</p>";
    });
}
</script>

     <script src="JS/baidang.js"></script>
         <script src="JS/index.js"></script>
   <script src="/JS/Giohang.js"></script>
</html>
